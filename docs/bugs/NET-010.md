# NET-010: Nested Record/Anonymous Type Reconstruction from Flat Schema

| Field | Value |
|-------|-------|
| **Status** | ðŸ”´ Open |
| **Severity** | ðŸ”´ High |
| **Product** | DataLinq.NET |
| **Component** | `ObjectMaterializer` |
| **Discovered** | 2026-02-14 |

## Summary
`ObjectMaterializer.Create<T>()` fails to construct types with nested record/anonymous-type constructor parameters when given a flat schema. Instead of recursively constructing the inner type from matching columns, it fails because the outer constructor parameter (e.g., `Key` of type `GroupKey`) has no direct match in the schema dictionary.

## Impact
**High** â€” Blocks Snowflake GroupBy + Select queries that produce anonymous types like `new { Key = new { IsActive, Region }, Count }`. Snowflake returns flat columns; the materializer must reconstruct the nesting.

## Root Cause
`CreateViaPrimaryConstructorWithSchema()` does a flat lookup: `schemaDict.TryGetValue(paramName, ...)`. When a parameter name like `Key` doesn't exist in the schema, it falls through to the default/missing path. No recursive construction is attempted.

The same issue affects `CtorMaterializationSession` via `ConstructorHelper.BuildParamMap()`, which returns `-1` for unmapped nested params.

## Tests
- `Create_WithNestedRecord_ShouldReconstructFromFlatSchema`
- `CreateCtorSession_WithNestedRecord_ShouldReconstructFromFlatSchema`
